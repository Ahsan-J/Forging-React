"use strict";var __assign=this&&this.__assign||function(){return(__assign=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},__read=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,o=n.call(e),s=[];try{for(;(void 0===t||0<t--)&&!(r=o.next()).done;)s.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(a)throw a.error}}return s},__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}},jsx_runtime_1=(Object.defineProperty(exports,"__esModule",{value:!0}),require("react/jsx-runtime")),react_1=require("react"),Pagination_1=__importDefault(require("../Pagination/Pagination")),aphrodite_1=require("../../helpers/aphrodite"),Table_styles_1=require("./Table.styles"),utility_1=require("../../helpers/utility"),Icon_1=__importDefault(require("../Icon")),Spinner_1=__importDefault(require("../Spinner"));function Table(o){var n=o.onSortData,t=o.onPageChange,r=o.onRowItemClick,a=o.rowClass,s=o.renderOnRowHover,e=o.className,e=void 0===e?"":e,l=o.pageSize,i=void 0===l?10:l,l=o.currentPage,c=void 0===l?1:l,l=o.bgAlpha,l=void 0===l?80:l,u=o.autoSort,d=void 0===u||u,u=o.showNumberLength,u=void 0===u?6:u,_=o.size,m=void 0===_?"base":_,f=(0,react_1.useId)(),_=__read((0,react_1.useState)(),2),p=_[0],h=_[1],_=__read((0,react_1.useState)("asc"),2),x=_[0],y=_[1],_=__read((0,react_1.useState)(c),2),g=_[0],j=_[1],_=__read((0,react_1.useState)(null),2),b=_[0],v=_[1],k=(0,Table_styles_1.useStyles)({clickable:!!r,size:m,bgAlpha:l}),C=(0,react_1.useRef)(null),S=(0,react_1.useRef)(null),I=(0,react_1.useMemo)(function(){return"function"==typeof o.data?o.data(g-1):o.data&&o.data instanceof Array&&0<o.data.length?o.data:[]},[o,g]),w=(0,react_1.useMemo)(function(){return Object.keys(I).length},[I]),N=(0,react_1.useMemo)(function(){return Object.keys(o.columnHeadings||{}).length},[o.columnHeadings]),M=(0,react_1.useMemo)(function(){return o.total||w},[o.total,w]),P=(0,react_1.useCallback)(function(e,t){y(t),h(e),n&&n(e,t)},[n]),_=((0,react_1.useEffect)(function(){"string"!=typeof c&&"number"!=typeof c||j(parseInt("".concat(c),10))},[c]),(0,react_1.useCallback)(function(e){"number"!=typeof o.currentPage&&j(e),t&&t(e)},[t,o.currentPage])),R=(0,react_1.useCallback)(function(e,t){r&&r(e,t+g*i)},[g,r,i]),q=(0,react_1.useCallback)(function(r,a,e){var t,n=(null==(n=null==(n=r.keyIndex)?void 0:n.toString())?void 0:n.split(",")).reduce(function(e,t){var n="".concat(t).split(".");return 0<n.length?(n=n.reduce(function(e,t){return e=e&&"object"==typeof e?e[t]:e},a),e[t]=n):e[r.keyIndex]="".concat(t||""),e},{});return r.render?(t=1<Object.keys(n).length?n:n[r.keyIndex],e=e+(g-1)*(o.pageSize||1),r.render(t,r.keyIndex,e)):"string"==typeof(t=n[r.keyIndex])||"number"==typeof t?t:"N/A"},[g,o.pageSize]),O=(0,react_1.useCallback)(function(e){return void 0===(null==e?void 0:e.sortIndex)?null==e?void 0:e.keyIndex:null==e?void 0:e.sortIndex},[]),z=(0,react_1.useCallback)(function(e){return p?null==e?void 0:e.sort(function(e,t){e=e[p],t=t[p];return"number"==typeof e&&"number"==typeof t?"asc"==x?e-t:t-e:"string"==typeof e&&"string"==typeof t?"asc"==x?e.localeCompare(t):t.localeCompare(e):0}):e},[p,x]),l=(0,react_1.useMemo)(function(){var e;return null==(e=o.columnHeadings)?void 0:e.map(function(t,e){var n=O(t);return(0,jsx_runtime_1.jsxs)("th",{scope:"col",onClick:function(){var e;t.sortable&&(e="asc",P(n,e=p===n&&x===e?"desc":"asc"))},id:f+t.keyIndex.toString(),style:__assign({cursor:t.sortable?"pointer":"default"},t.style),children:[t.renderColumn?t.renderColumn(t,e):t.label||t.keyIndex.toString(),t.sortable&&(p===n?(0,jsx_runtime_1.jsx)(Icon_1.default,{name:"asc"===x?"caret-up-fill":"caret-down-fill"}):(0,jsx_runtime_1.jsx)(Icon_1.default,{name:"caret-right-fill"}))]},t.keyIndex.toString())})},[O,p,x,o.columnHeadings,f,P]),D=(0,react_1.useMemo)(function(){return o.loading||0==M?(0,jsx_runtime_1.jsx)("tr",{children:(0,jsx_runtime_1.jsx)("td",{colSpan:N,children:(0,jsx_runtime_1.jsx)("div",{className:(0,aphrodite_1.css)(k.loadingContainer),children:o.loading?(0,jsx_runtime_1.jsx)(Spinner_1.default,{loader:o.loading,size:m}):(0,jsx_runtime_1.jsxs)(jsx_runtime_1.Fragment,{children:[(0,jsx_runtime_1.jsx)(Icon_1.default,{width:"3rem",height:"3rem",name:"folder-x"}),(0,jsx_runtime_1.jsx)("p",{children:"No Data"})]})})})}):null},[o.loading,M,N,k.loadingContainer,m]),H=(0,react_1.useMemo)(function(){var e=d?z(I):I,e=I.length&&"number"!=typeof o.currentPage?(0,utility_1.chunkArray)(e,i)[g-1]:e;return null==e?void 0:e.map(function(n,r){var e;return(0,jsx_runtime_1.jsx)("tr",{onMouseEnter:s?v.bind(null,n):void 0,onClick:R.bind(null,n,r),style:o.rowStyle,className:"".concat((0,aphrodite_1.css)(k.tableRowClass)," ").concat((null==a?void 0:a(n,r))||""),children:null==(e=o.columnHeadings)?void 0:e.map(function(e,t){return e.primaryColumn?(0,jsx_runtime_1.jsx)("th",{scope:"row",headers:f+e.keyIndex.toString(),style:e.style,className:e.className,children:q(e,n,r)},"".concat(r,"-").concat(t)):(0,jsx_runtime_1.jsx)("td",{headers:f+e.keyIndex.toString(),style:e.style,className:e.className,children:q(e,n,r)},"".concat(r,"-").concat(t))})},"".concat(r,"-").concat(g))})},[d,I,i,f,o.currentPage,o.columnHeadings,o.rowStyle,z,g,k,s,a,R,q]),T=(0,react_1.useCallback)(function(e){var t,n;s&&b&&S.current&&C.current&&(t=C.current.getBoundingClientRect(),n=e.clientX-t.left+5,e=e.clientY-t.top+5,S.current.style.transform="translate(".concat(n,"px,").concat(e,"px)"))},[b,s]);return N<=0?null:(0,jsx_runtime_1.jsxs)("table",{id:o.id,"data-testid":o.id,ref:C,className:"".concat((0,aphrodite_1.css)(k.container)," ").concat(e),style:o.style,children:[(0,jsx_runtime_1.jsx)("thead",{children:(0,jsx_runtime_1.jsx)("tr",{className:"".concat((0,aphrodite_1.css)(k.tableRowClass)," ").concat(o.headerRowClass||""),children:l})}),(0,jsx_runtime_1.jsxs)("tbody",{onMouseMove:T,onMouseLeave:v.bind(null,null),children:[D,H,s&&b?(0,jsx_runtime_1.jsx)("tr",{ref:S,className:"".concat((0,aphrodite_1.css)(k.hoverRow)," ").concat(o.hoverWrapperClassName||""),children:(0,jsx_runtime_1.jsx)("td",{colSpan:N,children:null==s?void 0:s(b,0)})}):null]}),i&&0<M&&i<M?(0,jsx_runtime_1.jsx)("tfoot",{children:(0,jsx_runtime_1.jsx)("tr",{className:"".concat((0,aphrodite_1.css)(k.tableRowClass)," ").concat(o.footerRowClass||""),style:{borderWidth:0},children:(0,jsx_runtime_1.jsx)("td",{colSpan:N,children:(0,jsx_runtime_1.jsx)(Pagination_1.default,{size:m,className:(0,aphrodite_1.css)(k.pagination),type:o.type,disabled:o.loading,onItemClick:_,showNumberLength:u,total:M/i,currentPage:g})})})}):null]})}Table.displayName="Table",exports.default=Table;